<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Award í‰ê°€í•˜ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .star {
            cursor: pointer;
            font-size: 3rem;
            color: #d1d5db;
            transition: all 0.3s ease;
            display: inline-block;
            filter: grayscale(100%);
            opacity: 0.5;
        }
        .star:hover {
            transform: scale(1.2);
            filter: grayscale(0%);
            opacity: 1;
        }
        .star.active {
            color: #fbbf24;
            filter: grayscale(0%) drop-shadow(0 0 10px #fbbf24);
            opacity: 1;
            transform: scale(1.3);
            animation: pulse 0.3s ease;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1.3); }
            50% { transform: scale(1.5); }
        }
        .star-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .selected-rating {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: bold;
            margin-top: 1rem;
            text-align: center;
            min-height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <h1 class="text-3xl font-bold text-center text-indigo-600 mb-8" id="mainTitle">ğŸ† Award í‰ê°€í•˜ê¸°</h1>
            
            <!-- ë¡œê·¸ì¸ í™”ë©´ -->
            <div id="loginScreen">
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ì‚¬ìš©ì ì„ íƒ</label>
                        <select id="userSelect" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">PIN ë²ˆí˜¸ (4ìë¦¬)</label>
                        <input type="password" id="pinInput" maxlength="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-center text-2xl tracking-widest" placeholder="â€¢â€¢â€¢â€¢">
                    </div>
                    
                    <button id="loginBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-lg transition text-lg">
                        ë¡œê·¸ì¸
                    </button>
                </div>
            </div>

            <!-- ë¡œë”© ìƒíƒœ -->
            <div id="loadingState" class="hidden text-center py-12">
                <p class="text-gray-600">í‰ê°€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <!-- í‰ê°€ ì—†ìŒ -->
            <div id="noAwardState" class="hidden text-center py-12">
                <p class="text-xl text-gray-600">í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                <p class="text-sm text-gray-400 mt-2">ê´€ë¦¬ìê°€ í‰ê°€ë¥¼ ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
                <button id="logoutBtn1" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">
                    ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>

            <!-- í‰ê°€ í¼ -->
            <div id="evaluationForm" class="hidden">
                <!-- ì´ë¯¸ í‰ê°€ ì™„ë£Œ ì•Œë¦¼ -->
                <div id="alreadyVotedAlert" class="hidden mb-6 bg-yellow-50 border-2 border-yellow-300 rounded-lg p-4">
                    <div class="flex items-center gap-2">
                        <span class="text-2xl">âœ…</span>
                        <div>
                            <p class="font-bold text-yellow-800">ì´ë¯¸ í‰ê°€ ì™„ë£Œ</p>
                            <p class="text-sm text-yellow-700">ì´ Awardì— ëŒ€í•œ í‰ê°€ë¥¼ ì´ë¯¸ ì œì¶œí•˜ì…¨ìŠµë‹ˆë‹¤</p>
                        </div>
                    </div>
                </div>

                <div class="bg-indigo-50 rounded-lg p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4" id="awardTitle"></h2>
                    
                    <div class="space-y-2 text-sm">
                        <div>
                            <span class="font-semibold text-indigo-600">ğŸ‘‘ Impact Maker:</span>
                            <span id="impactMaker" class="text-gray-700 ml-2"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-indigo-600">ğŸ’ª Core Member:</span>
                            <span id="coreMember" class="text-gray-700 ml-2"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-indigo-600">âœ¨ Special Thanks:</span>
                            <span id="specialThanks" class="text-gray-700 ml-2"></span>
                        </div>
                    </div>
                </div>

                <div class="space-y-8">
                    <!-- Q1: Award ìœ í˜• -->
                    <div>
                        <label class="block text-lg font-semibold text-gray-800 mb-4">
                            Q1. ì´ Awardì˜ ìœ í˜•ì€? <span class="text-red-500">*</span>
                        </label>
                        <div class="space-y-3">
                            <button class="award-type w-full bg-white border-2 border-gray-200 hover:border-indigo-500 hover:bg-indigo-50 text-gray-700 py-3 rounded-lg transition" data-type="ë…¸ë ¥í˜•">
                                ğŸ’ª ë…¸ë ¥í˜•
                            </button>
                            <button class="award-type w-full bg-white border-2 border-gray-200 hover:border-indigo-500 hover:bg-indigo-50 text-gray-700 py-3 rounded-lg transition" data-type="í˜ì‹ í˜•">
                                ğŸš€ í˜ì‹ í˜•
                            </button>
                            <button class="award-type w-full bg-white border-2 border-gray-200 hover:border-indigo-500 hover:bg-indigo-50 text-gray-700 py-3 rounded-lg transition" data-type="ì°½ì¡°í˜•">
                                ğŸ¨ ì°½ì¡°í˜•
                            </button>
                            <button class="award-type w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg transition" data-type="ì˜ ëª¨ë¥´ê² ìŒ">
                                â“ ì˜ ëª¨ë¥´ê² ìŒ
                            </button>
                        </div>
                    </div>

                    <!-- Q2: ì˜í–¥ë ¥ -->
                    <div>
                        <label class="block text-lg font-semibold text-gray-800 mb-4">
                            Q2. ì´ Awardì˜ ì˜í–¥ë ¥ì€? <span class="text-red-500">*</span>
                        </label>
                        <div class="star-container">
                            <div class="flex justify-center gap-1" id="starRating">
                                <span class="star" data-value="1">â­</span>
                                <span class="star" data-value="2">â­</span>
                                <span class="star" data-value="3">â­</span>
                                <span class="star" data-value="4">â­</span>
                                <span class="star" data-value="5">â­</span>
                            </div>
                            <div class="selected-rating" id="ratingDisplay">
                                ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”
                            </div>
                        </div>
                        <button id="dontKnowImpact" class="w-full mt-4 bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 rounded-lg transition">
                            ì˜ ëª¨ë¥´ê² ìŒ
                        </button>
                    </div>

                    <button id="submitBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-lg transition text-lg disabled:bg-gray-300 disabled:cursor-not-allowed disabled:hover:bg-gray-300">
                        í‰ê°€ ì œì¶œí•˜ê¸°
                    </button>
                    
                    <button id="logoutBtn2" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 rounded-lg">
                        ë¡œê·¸ì•„ì›ƒ
                    </button>
                </div>
            </div>

            <!-- ì™„ë£Œ í™”ë©´ -->
            <div id="successState" class="hidden text-center py-12">
                <div class="text-6xl mb-4">âœ…</div>
                <p class="text-2xl font-bold text-green-600 mb-2">í‰ê°€ ì™„ë£Œ!</p>
                <p class="text-gray-600">ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤</p>
                <p class="text-sm text-gray-500 mt-4">ê´€ë¦¬ìê°€ ë‹¤ìŒ í‰ê°€ë¥¼ ì‹œì‘í•˜ë©´ ìë™ìœ¼ë¡œ í™”ë©´ì´ ì „í™˜ë©ë‹ˆë‹¤</p>
                <button id="logoutBtn3" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-lg">
                    ë¡œê·¸ì•„ì›ƒ
                </button>
            </div>
        </div>
    </div>

    <script>
        let selectedRating = 0;
        let selectedType = '';
        let currentAwardId = null;
        let currentUser = null;
        let currentAward = null;
        let hasVoted = false;

        function getState() {
            return JSON.parse(localStorage.getItem('awardVotingState') || '{"awards":[],"evaluations":[],"users":[]}');
        }

        function saveState(state) {
            localStorage.setItem('awardVotingState', JSON.stringify(state));
        }

        // ì‚¬ìš©ì ëª©ë¡ ë¡œë“œ
        function loadUsers() {
            const state = getState();
            const userSelect = document.getElementById('userSelect');
            userSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
            
            state.users.forEach(user => {
                const option = document.createElement('option');
                option.value = user.name;
                option.textContent = user.name;
                userSelect.appendChild(option);
            });
        }

        // ì¤‘ë³µ íˆ¬í‘œ í™•ì¸
        function hasAlreadyVoted(userName, awardId) {
            const state = getState();
            return state.evaluations.some(e => e.userName === userName && e.awardId === awardId);
        }

        // ë¡œê·¸ì¸
        document.getElementById('loginBtn').addEventListener('click', () => {
            const selectedName = document.getElementById('userSelect').value;
            const enteredPin = document.getElementById('pinInput').value;

            if (!selectedName) {
                alert('ì‚¬ìš©ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            if (!enteredPin || enteredPin.length !== 4) {
                alert('4ìë¦¬ PIN ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
                return;
            }

            const state = getState();
            const user = state.users.find(u => u.name === selectedName && u.pin === enteredPin);

            if (!user) {
                alert('ì‚¬ìš©ì ì •ë³´ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!');
                return;
            }

            currentUser = user.name;
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            loadCurrentAward();
        });

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            currentUser = null;
            currentAward = null;
            hasVoted = false;
            selectedRating = 0;
            selectedType = '';
            document.getElementById('userSelect').value = '';
            document.getElementById('pinInput').value = '';
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('noAwardState').classList.add('hidden');
            document.getElementById('evaluationForm').classList.add('hidden');
            document.getElementById('successState').classList.add('hidden');
            document.getElementById('mainTitle').textContent = 'ğŸ† Award í‰ê°€í•˜ê¸°';
            updateStars();
            updateRatingDisplay();
            document.querySelectorAll('.award-type').forEach(b => {
                b.classList.remove('border-indigo-500', 'bg-indigo-50');
                b.classList.add('border-gray-200', 'bg-white');
            });
        }

        document.getElementById('logoutBtn1').addEventListener('click', logout);
        document.getElementById('logoutBtn2').addEventListener('click', logout);
        document.getElementById('logoutBtn3').addEventListener('click', logout);

        // ë³„ì  í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateRatingDisplay() {
            const display = document.getElementById('ratingDisplay');
            if (selectedRating === -1) {
                display.textContent = 'â“ ì˜ ëª¨ë¥´ê² ìŒ';
                display.style.background = 'rgba(156, 163, 175, 0.3)';
            } else if (selectedRating > 0) {
                const stars = 'â­'.repeat(selectedRating);
                display.textContent = `${stars} ${selectedRating}ì  ì„ íƒë¨`;
                display.style.background = 'rgba(251, 191, 36, 0.3)';
            } else {
                display.textContent = 'ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”';
                display.style.background = 'rgba(255,255,255,0.2)';
            }
        }

        // ë³„ì  ì„ íƒ
        document.querySelectorAll('.star').forEach(star => {
            star.addEventListener('click', function(e) {
                e.preventDefault();
                if (hasVoted) return;
                
                selectedRating = parseInt(this.getAttribute('data-value'));
                updateStars();
                updateRatingDisplay();
            });
        });

        function updateStars() {
            document.querySelectorAll('.star').forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        // ì˜ ëª¨ë¥´ê² ìŒ (ì˜í–¥ë ¥)
        document.getElementById('dontKnowImpact').addEventListener('click', function(e) {
            e.preventDefault();
            if (hasVoted) return;
            
            selectedRating = -1;
            document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
            updateRatingDisplay();
        });

        // Award ìœ í˜• ì„ íƒ
        document.querySelectorAll('.award-type').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                if (hasVoted) return;
                
                selectedType = this.getAttribute('data-type');
                document.querySelectorAll('.award-type').forEach(b => {
                    b.classList.remove('border-indigo-500', 'bg-indigo-50');
                    b.classList.add('border-gray-200', 'bg-white');
                });
                this.classList.remove('border-gray-200', 'bg-white');
                this.classList.add('border-indigo-500', 'bg-indigo-50');
            });
        });

        // í˜„ì¬ í‰ê°€ ì¤‘ì¸ Award ê°€ì ¸ì˜¤ê¸°
        function loadCurrentAward() {
            const state = getState();
            const award = state.awards.find(a => a.isActive);

            if (!award) {
                document.getElementById('loadingState').classList.add('hidden');
                document.getElementById('noAwardState').classList.remove('hidden');
                document.getElementById('evaluationForm').classList.add('hidden');
                document.getElementById('successState').classList.add('hidden');
                document.getElementById('mainTitle').textContent = 'ğŸ† Award í‰ê°€í•˜ê¸°';
                return;
            }

            // ì œëª©ì— ì—°ë„/ë¶„ê¸° í‘œì‹œ
            document.getElementById('mainTitle').textContent = `ğŸ† ${award.year}ë…„ ${award.quarter} Award í‰ê°€í•˜ê¸°`;

            // ì¤‘ë³µ íˆ¬í‘œ í™•ì¸
            hasVoted = hasAlreadyVoted(currentUser, award.id);

            // Awardê°€ ë³€ê²½ë˜ì—ˆìœ¼ë©´ ì…ë ¥ ì´ˆê¸°í™”
            if (currentAwardId !== award.id) {
                selectedRating = 0;
                selectedType = '';
                updateStars();
                updateRatingDisplay();
                document.querySelectorAll('.award-type').forEach(b => {
                    b.classList.remove('border-indigo-500', 'bg-indigo-50');
                    b.classList.add('border-gray-200', 'bg-white');
                });
            }

            currentAwardId = award.id;
            currentAward = award;
            document.getElementById('awardTitle').textContent = award.title;
            document.getElementById('impactMaker').textContent = award.impactMaker || '-';
            document.getElementById('coreMember').textContent = award.coreMember || '-';
            document.getElementById('specialThanks').textContent = award.specialThanks || '-';

            // ì´ë¯¸ í‰ê°€í•œ ê²½ìš° ì•Œë¦¼ í‘œì‹œ ë° ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
            const submitBtn = document.getElementById('submitBtn');
            const alreadyVotedAlert = document.getElementById('alreadyVotedAlert');
            
            if (hasVoted) {
                alreadyVotedAlert.classList.remove('hidden');
                submitBtn.disabled = true;
                submitBtn.textContent = 'ì´ë¯¸ í‰ê°€ ì™„ë£Œ';
            } else {
                alreadyVotedAlert.classList.add('hidden');
                submitBtn.disabled = false;
                submitBtn.textContent = 'í‰ê°€ ì œì¶œí•˜ê¸°';
            }

            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('noAwardState').classList.add('hidden');
            document.getElementById('evaluationForm').classList.remove('hidden');
            document.getElementById('successState').classList.add('hidden');
        }

        // í‰ê°€ ì œì¶œ
        document.getElementById('submitBtn').addEventListener('click', () => {
            if (hasVoted) {
                alert('ì´ë¯¸ í‰ê°€ë¥¼ ì™„ë£Œí•˜ì…¨ìŠµë‹ˆë‹¤.');
                return;
            }

            // í•„ìˆ˜ ì…ë ¥ ê²€ì¦
            if (!selectedType) {
                alert('Award ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            if (selectedRating === 0) {
                alert('ì˜í–¥ë ¥ í‰ê°€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”! (ë³„ì  ë˜ëŠ” "ì˜ ëª¨ë¥´ê² ìŒ")');
                return;
            }

            const state = getState();

            state.evaluations.push({
                awardId: currentAwardId,
                rating: selectedRating,
                type: selectedType,
                userName: currentUser,
                timestamp: new Date().toISOString()
            });

            saveState(state);

            document.getElementById('evaluationForm').classList.add('hidden');
            document.getElementById('successState').classList.remove('hidden');

            // ì…ë ¥ ì´ˆê¸°í™” (ë‹¤ìŒ Awardë¥¼ ìœ„í•´)
            selectedRating = 0;
            selectedType = '';
            updateStars();
            updateRatingDisplay();
            document.querySelectorAll('.award-type').forEach(b => {
                b.classList.remove('border-indigo-500', 'bg-indigo-50');
                b.classList.add('border-gray-200', 'bg-white');
            });
        });

        // 1ì´ˆë§ˆë‹¤ ìƒˆë¡œìš´ Award í™•ì¸ (ë¡œê·¸ì¸í•œ ê²½ìš°ë§Œ)
        setInterval(() => {
            if (currentUser) {
                loadCurrentAward();
            }
        }, 1000);

        // ì´ˆê¸°í™”
        loadUsers();
    </script>
</body>
</html>
