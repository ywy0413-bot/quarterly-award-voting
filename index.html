<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Award í‰ê°€í•˜ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .star {
            cursor: pointer;
            font-size: 2.5rem;
            color: #d1d5db;
            transition: color 0.2s;
        }
        .star.active {
            color: #fbbf24;
        }
        .star:hover {
            color: #fbbf24;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <div class="bg-white rounded-2xl shadow-2xl p-8">
            <h1 class="text-3xl font-bold text-center text-indigo-600 mb-8">ğŸ† Award í‰ê°€í•˜ê¸°</h1>
            
            <div id="loadingState" class="text-center py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
                <p class="mt-4 text-gray-600">í‰ê°€ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>

            <div id="noAwardState" class="hidden text-center py-12">
                <p class="text-xl text-gray-600">í˜„ì¬ ì§„í–‰ ì¤‘ì¸ í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                <p class="text-sm text-gray-400 mt-2">ê´€ë¦¬ìê°€ í‰ê°€ë¥¼ ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
            </div>

            <div id="evaluationForm" class="hidden">
                <div class="bg-indigo-50 rounded-lg p-6 mb-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4" id="awardTitle"></h2>
                    
                    <div class="space-y-2 text-sm">
                        <div>
                            <span class="font-semibold text-indigo-600">ğŸ‘‘ Impact Maker:</span>
                            <span id="impactMaker" class="text-gray-700 ml-2"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-indigo-600">ğŸ’ª Core Member:</span>
                            <span id="coreMember" class="text-gray-700 ml-2"></span>
                        </div>
                        <div>
                            <span class="font-semibold text-indigo-600">âœ¨ Special Thanks:</span>
                            <span id="specialThanks" class="text-gray-700 ml-2"></span>
                        </div>
                    </div>
                </div>

                <div class="space-y-8">
                    <div>
                        <label class="block text-lg font-semibold text-gray-800 mb-4">
                            Q1. ì´ Awardì˜ ì˜í–¥ë ¥ì€?
                        </label>
                        <div class="flex justify-center gap-2 mb-4" id="starRating">
                            <span class="star" data-value="1">â­</span>
                            <span class="star" data-value="2">â­</span>
                            <span class="star" data-value="3">â­</span>
                            <span class="star" data-value="4">â­</span>
                            <span class="star" data-value="5">â­</span>
                        </div>
                        <button id="dontKnowImpact" class="w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-2 rounded-lg transition">
                            ì˜ ëª¨ë¥´ê² ìŒ
                        </button>
                    </div>

                    <div>
                        <label class="block text-lg font-semibold text-gray-800 mb-4">
                            Q2. ì´ Awardì˜ ìœ í˜•ì€?
                        </label>
                        <div class="space-y-3">
                            <button class="award-type w-full bg-white border-2 border-gray-200 hover:border-indigo-500 hover:bg-indigo-50 text-gray-700 py-3 rounded-lg transition" data-type="ë…¸ë ¥í˜•">
                                ğŸ’ª ë…¸ë ¥í˜•
                            </button>
                            <button class="award-type w-full bg-white border-2 border-gray-200 hover:border-indigo-500 hover:bg-indigo-50 text-gray-700 py-3 rounded-lg transition" data-type="í˜ì‹ í˜•">
                                ğŸš€ í˜ì‹ í˜•
                            </button>
                            <button class="award-type w-full bg-white border-2 border-gray-200 hover:border-indigo-500 hover:bg-indigo-50 text-gray-700 py-3 rounded-lg transition" data-type="ì°½ì¡°í˜•">
                                ğŸ¨ ì°½ì¡°í˜•
                            </button>
                            <button class="award-type w-full bg-gray-100 hover:bg-gray-200 text-gray-700 py-3 rounded-lg transition" data-type="ì˜ ëª¨ë¥´ê² ìŒ">
                                â“ ì˜ ëª¨ë¥´ê² ìŒ
                            </button>
                        </div>
                    </div>

                    <button id="submitBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-lg transition text-lg disabled:bg-gray-300 disabled:cursor-not-allowed">
                        í‰ê°€ ì œì¶œí•˜ê¸°
                    </button>
                </div>
            </div>

            <div id="successState" class="hidden text-center py-12">
                <div class="text-6xl mb-4">âœ…</div>
                <p class="text-2xl font-bold text-green-600 mb-2">í‰ê°€ ì™„ë£Œ!</p>
                <p class="text-gray-600">ì†Œì¤‘í•œ ì˜ê²¬ ê°ì‚¬í•©ë‹ˆë‹¤</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, query, where, getDocs, addDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyC23FHBCtNPXXekdPgeYJZOyHU8SwIHWU",
            authDomain: "quarterly-award-voting.firebaseapp.com",
            projectId: "quarterly-award-voting",
            storageBucket: "quarterly-award-voting.firebasestorage.app",
            messagingSenderId: "1057289910549",
            appId: "1:1057289910549:web:e0d79116ad23e3f670911c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let selectedRating = 0;
        let selectedType = '';
        let currentAwardId = null;

        document.querySelectorAll('.star').forEach(star => {
            star.addEventListener('click', () => {
                selectedRating = parseInt(star.dataset.value);
                updateStars();
            });
        });

        function updateStars() {
            document.querySelectorAll('.star').forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.add('active');
                } else {
                    star.classList.remove('active');
                }
            });
        }

        document.getElementById('dontKnowImpact').addEventListener('click', () => {
            selectedRating = -1;
            document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
        });

        document.querySelectorAll('.award-type').forEach(btn => {
            btn.addEventListener('click', () => {
                selectedType = btn.dataset.type;
                document.querySelectorAll('.award-type').forEach(b => {
                    b.classList.remove('border-indigo-500', 'bg-indigo-50');
                    b.classList.add('border-gray-200', 'bg-white');
                });
                btn.classList.remove('border-gray-200', 'bg-white');
                btn.classList.add('border-indigo-500', 'bg-indigo-50');
            });
        });

        async function loadCurrentAward() {
            const q = query(collection(db, 'awards'), where('isActive', '==', true));
            
            onSnapshot(q, (snapshot) => {
                if (snapshot.empty) {
                    document.getElementById('loadingState').classList.add('hidden');
                    document.getElementById('noAwardState').classList.remove('hidden');
                    document.getElementById('evaluationForm').classList.add('hidden');
                } else {
                    const award = snapshot.docs[0].data();
                    currentAwardId = snapshot.docs[0].id;
                    
                    document.getElementById('awardTitle').textContent = award.title;
                    document.getElementById('impactMaker').textContent = award.impactMaker || '-';
                    document.getElementById('coreMember').textContent = award.coreMember || '-';
                    document.getElementById('specialThanks').textContent = award.specialThanks || '-';
                    
                    document.getElementById('loadingState').classList.add('hidden');
                    document.getElementById('noAwardState').classList.add('hidden');
                    document.getElementById('evaluationForm').classList.remove('hidden');
                    document.getElementById('successState').classList.add('hidden');
                }
            });
        }

        document.getElementById('submitBtn').addEventListener('click', async () => {
            if (selectedRating === 0 || !selectedType) {
                alert('ëª¨ë“  ë¬¸í•­ì— ë‹µë³€í•´ì£¼ì„¸ìš”!');
                return;
            }

            try {
                await addDoc(collection(db, 'evaluations'), {
                    awardId: currentAwardId,
                    rating: selectedRating,
                    type: selectedType,
                    timestamp: new Date()
                });

                document.getElementById('evaluationForm').classList.add('hidden');
                document.getElementById('successState').classList.remove('hidden');

                setTimeout(() => {
                    selectedRating = 0;
                    selectedType = '';
                    updateStars();
                    document.querySelectorAll('.award-type').forEach(b => {
                        b.classList.remove('border-indigo-500', 'bg-indigo-50');
                        b.classList.add('border-gray-200', 'bg-white');
                    });
                    loadCurrentAward();
                }, 2000);

            } catch (error) {
                console.error('Error:', error);
                alert('í‰ê°€ ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        });

        loadCurrentAward();
    </script>
</body>
</html>
